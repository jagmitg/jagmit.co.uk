---
import { generateUniqueTags } from "@utils/collections";
import type { GetStaticPathsOptions } from "astro";
import Layout from "@layouts/Layout.astro";
import MainLayout from "@layouts/MainLayout.astro";
import stackOverflowData from "../../data/stackoverflow.json";
import { formatDate } from "@utils/formatDate";
import External from "@components/icons/External.astro";
import { PAGINATE_CONTENT } from "@const";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const questions = Object.values(stackOverflowData.data);

  return paginate(questions, {
    pageSize: PAGINATE_CONTENT,
  });
}

const { page } = Astro.props;
const questions = page.data;
const allQuestions = Object.values(stackOverflowData.data);
const uniqueTags = generateUniqueTags(allQuestions);
---

<Layout
  title={page.lastPage > 1
    ? `My Stackoverflow Answers - Page ${page.currentPage}`
    : `My Stackoverflow Answers`}
>
  <MainLayout
    title="My StackOverflow Answers"
    pagination={{ prev: page.url.prev, next: page.url.next }}
  >
    <div class="select-wrapper">
      <select
        class="customSelectbox border shadow-sm bg-gray-700 rounded-md border-gray-300 text-gray-300"
        onchange="location.href=`/stackoverflow/tags/${this.value}/`"
      >
        <option selected disabled>tags...</option>
        {uniqueTags.map((tag) => <option value={tag}>{tag}</option>)}
      </select>
    </div>

    <div class="grid gap-4 grid-cols-1 grid-rows-2 mt-5 lg:grid-cols-2">
      {
        questions.map((question: any) => (
          <>
            <a
              href={question.link}
              target="_blank"
              rel="noopener noreferrer"
              class="p-4 border mb-2 border-neutral-200 bg-neutral-50 rounded flex items-center justify-between px-3 py-4 w-full hover:bg-neutral-200 transition-colors"
            >
              <div class="flex flex-col">
                <p class="font-bold text-neutral-900 ">{question.key}</p>
                <p class="font-bold text-neutral-900 ">{question.title}</p>
                <p class="text-neutral-600 ">
                  {formatDate(question.creation_date)}
                </p>
                <p class="text-neutral-600 ">
                  Tags: {question.tags.join(", ")}
                </p>
              </div>
              <div class="text-neutral-700">
                <External />
              </div>
            </a>
          </>
        ))
      }
    </div>
  </MainLayout>
</Layout>
