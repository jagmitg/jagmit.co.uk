---
import { generateUniqueTags, matchesTagDefinition } from "@utils/collections";
import Layout from "@layouts/Layout.astro";
import MainLayout from "@layouts/MainLayout.astro";
import { PAGINATE_CONTENT, TAGS_DEFINITION } from "@const";
import stackOverflowData from "../../../../data/stackoverflow.json";

export async function getStaticPaths({ paginate }) {
  const questions = Object.values(stackOverflowData.data);
  const tags = generateUniqueTags(questions);

  const pathsArray = tags.map((tag: any) => {
    const filteredQuestions = questions.filter(
      (post: any) =>
        post.tags &&
        post.tags.some((current: any) =>
          matchesTagDefinition(current, TAGS_DEFINITION[tag] || []),
        ),
    );
    return paginate(filteredQuestions, {
      params: { tag },
      pageSize: PAGINATE_CONTENT,
      props: { questions: filteredQuestions },
    });
  });

  return pathsArray.flat();
}
const allQuestions = Object.values(stackOverflowData.data);
const uniqueTags = generateUniqueTags(allQuestions);

// const { tag } = Astro.params;
const { questions, page } = Astro.props;
---

<Layout>
  <MainLayout pagination={{ prev: page.url.prev, next: page.url.next }}>
    <h2 class="text-2xl mb-4">Tag: {Astro.params.tag}</h2>
    <div class="select-wrapper">
      <select
        class="customSelectbox border shadow-sm bg-gray-700 rounded-md border-gray-300 text-gray-300"
        onchange="location.href=`/stackoverflow/tags/${this.value}/`"
      >
        <option selected disabled>tags...</option>
        {
          uniqueTags.map((tag) => (
            <option value={tag} selected={tag === Astro.params.tag}>
              {tag}
            </option>
          ))
        }
      </select>
    </div>

    <div class="gap-4 flex flex-col">
      {
        questions?.map((question: any) => (
          <a
            href={question.link}
            target="_blank"
            rel="noopener noreferrer"
            class="p-4 border mb-2 border-neutral-200  bg-neutral-50 rounded flex items-center justify-between px-3 py-4 w-full hover:bg-neutral-200 transition-colors"
          >
            <div class="flex flex-col">
              <p class="font-bold text-neutral-900 ">{question.key}</p>
              <p class="font-bold text-neutral-900 ">{question.title}</p>
              <p class="text-neutral-600 " />
              <p class="text-neutral-600 ">Tags: {question.tags.join(", ")}</p>
            </div>
          </a>
        ))
      }
    </div>
  </MainLayout>
</Layout>
